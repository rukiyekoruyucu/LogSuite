@model IEnumerable<SmartDoors.Models.Log>

@{
    ViewData["Title"] = "Giriş-Çıkış Kayıtları";
}
<p>
    <a asp-controller="User" asp-action="Index">Kullanıcı Yönetimi</a>
</p>


<h2>Giriş-Çıkış Kayıtları</h2>

<form method="get">
    <input type="text" name="searchString" placeholder="İsim veya Soyisim Ara" value="@ViewBag.SearchString" />
    <select name="sortOrder">
        <option value="">Tarihe Göre (Yeni - Eski)</option>
        <option value="date_asc" selected="@(ViewBag.SortOrder == "date_asc" ? "selected" : null)">Tarihe Göre (Eski - Yeni)</option>
        <option value="error" selected="@(ViewBag.SortOrder == "error" ? "selected" : null)">Hatalı İşlemler</option>
    </select>
    <button type="submit">Filtrele</button>
</form>

<table border="1" cellpadding="5">
    <thead>
        <tr>
            <th>Kullanıcı</th>
            <th>İşlem</th>
            <th>Tarih</th>
            <th>Hata Durumu</th>
            <th>Yetki</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var log in Model)
        {
            <tr>
                <td>@(log.User?.FirstName ?? "Bilinmiyor") @(log.User?.LastName ?? "")</td>
                <td>@log.Operation</td>
                <td>@log.Timestamp.ToString("g")</td>
                <td>@(log.ErrorStatus ? "Hatalı" : "Başarılı")</td>
                <td>
                    @if (log.User != null)
                    {
                        <form asp-action="UpdateUserAccess" method="post" style="display:inline;">
                            <input type="hidden" name="userId" value="@log.User.UserID" />
                            <select name="doorAccess" onchange="this.form.submit()">
                                <option value="true" selected="@(log.User.DoorAccess ? "selected" : null)">Giriş İzni Var</option>
                                <option value="false" selected="@(!log.User.DoorAccess ? "selected" : null)">Giriş İzni Yok</option>
                            </select>
                        </form>
                    }
                </td>
            </tr>
        }
    </tbody>
</table>

